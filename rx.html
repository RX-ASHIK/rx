<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>টাকা আয় করুন - Earn Money</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Hind Siliguri', sans-serif;
        }
        .tab-active {
            border-bottom: 3px solid #3B82F6;
            color: #3B82F6;
            font-weight: 600;
        }
        .profile-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 60px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 200px;
            z-index: 100;
        }
        .profile-menu.active {
            display: block;
        }
        .profile-menu a {
            display: block;
            padding: 10px 15px;
            color: #333;
            text-decoration: none;
        }
        .profile-menu a:hover {
            background: #f0f0f0;
        }
    </style>
    <!-- Monitag Ad Script -->
    <script src='//libtl.com/sdk.js' data-zone='9571958' data-sdk='show_9571958'></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Header Section -->
        <header class="bg-blue-500 text-white rounded-lg p-4 shadow-md mb-6 relative">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-bold">টাকা আয় করুন</h1>
                    <p class="text-sm">টেলিগ্রামে থেকে আয় করুন সহজে</p>
                </div>
                <div class="relative">
                    <button id="profileBtn" class="bg-white text-blue-500 rounded-full w-12 h-12 flex items-center justify-center font-bold text-lg">
                        <span id="userInitial">U</span>
                    </button>
                    <div id="profileMenu" class="profile-menu">
                        <a href="#" data-tab="home"><i class="fas fa-home mr-2"></i> হোম</a>
                        <a href="#" data-tab="earn"><i class="fas fa-coins mr-2"></i> আয় করুন</a>
                        <a href="#" data-tab="refer"><i class="fas fa-users mr-2"></i> রেফার করুন</a>
                        <a href="#" data-tab="account"><i class="fas fa-user mr-2"></i> অ্যাকাউন্ট</a>
                        <a href="#" id="logoutMenuBtn"><i class="fas fa-sign-out-alt mr-2"></i> লগআউট</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Balance Card -->
        <div class="bg-white rounded-lg p-4 shadow-md mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <p class="text-gray-500 text-sm">আপনার ব্যালেন্স</p>
                    <h2 class="text-2xl font-bold" id="userBalance">৳0.00</h2>
                </div>
                <button class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm" id="withdrawBtn">
                    উত্তোলন
                </button>
            </div>
        </div>

        <!-- Tab Content -->
        <div id="tabContent">
            <!-- Home Tab -->
            <div id="homeTab" class="tab-panel active">
                <div class="bg-white rounded-lg p-4 shadow-md mb-4">
                    <h3 class="font-bold mb-2">আজকের স্ট্যাটাস</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <p class="text-gray-500 text-xs">আজকের আয়</p>
                            <p class="font-bold" id="todayEarning">৳0.00</p>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg">
                            <p class="text-gray-500 text-xs">রেফার সংখ্যা</p>
                            <p class="font-bold" id="referralCount">0</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-lg p-4 shadow-md">
                    <h3 class="font-bold mb-2">দ্রুত কাজ</h3>
                    <button class="w-full bg-blue-500 text-white py-3 rounded-lg mb-3" id="quickEarnBtn">
                        এখনই আয় করুন (৳0.50 - ৳1.00)
                    </button>
                    <button class="w-full bg-green-500 text-white py-3 rounded-lg" id="quickReferBtn">
                        রেফার করুন (৳10 পাবেন)
                    </button>
                </div>
            </div>

            <!-- Earn Tab -->
            <div id="earnTab" class="tab-panel hidden">
                <div class="bg-white rounded-lg p-4 shadow-md mb-6">
                    <h3 class="font-bold mb-4">ভিডিও দেখে আয় করুন</h3>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4">
                        <p class="text-sm text-yellow-800">আপনি আজ <span id="adsWatched">0</span> টি এড দেখেছেন (সর্বোচ্চ ১০০টি)</p>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div class="bg-blue-600 h-2.5 rounded-full" id="adsProgress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <button class="w-full bg-blue-500 text-white py-3 rounded-lg mb-3" id="watchAdBtn">
                        এড দেখুন (+৳0.50 - ৳1.00)
                    </button>
                    
                    <div class="text-center text-sm text-gray-500">
                        <p>প্রতিটি এড ৩০ সেকেন্ড দেখতে হবে</p>
                    </div>
                </div>
            </div>

            <!-- Refer Tab -->
            <div id="referTab" class="tab-panel hidden">
                <div class="bg-white rounded-lg p-4 shadow-md mb-6">
                    <h3 class="font-bold mb-4">বন্ধুদের রেফার করুন</h3>
                    <p class="mb-4 text-sm">প্রতিটি সফল রেফারে পাবেন <span class="font-bold">৳10</span></p>
                    
                    <div class="bg-blue-50 p-3 rounded-lg mb-4">
                        <p class="text-gray-500 text-xs mb-1">আপনার রেফার লিংক</p>
                        <div class="flex">
                            <input type="text" id="referralLink" class="flex-1 border border-gray-300 rounded-l-lg px-3 py-2 text-xs" readonly>
                            <button class="bg-blue-500 text-white px-3 py-2 rounded-r-lg text-xs" id="copyLinkBtn">
                                কপি
                            </button>
                        </div>
                    </div>
                    
                    <button class="w-full bg-green-500 text-white py-3 rounded-lg mb-3" id="shareLinkBtn">
                        শেয়ার করুন
                    </button>
                    
                    <div class="mt-4">
                        <h4 class="font-bold mb-2">আপনার রেফার্ড বন্ধু</h4>
                        <div class="bg-gray-100 rounded-lg p-3 text-center" id="referralList">
                            <p class="text-gray-500">কোন রেফার্ড ইউজার নেই</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Account Tab -->
            <div id="accountTab" class="tab-panel hidden">
                <div class="bg-white rounded-lg p-4 shadow-md mb-6">
                    <h3 class="font-bold mb-4">আপনার তথ্য</h3>
                    
                    <div class="flex items-center mb-4">
                        <div class="bg-blue-500 text-white rounded-full w-12 h-12 flex items-center justify-center font-bold text-lg mr-3">
                            <span id="accountInitial">U</span>
                        </div>
                        <div>
                            <p class="font-bold" id="userName">ইউজার</p>
                            <p class="text-gray-500 text-sm" id="userId">ID: 123456</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <p class="text-gray-500 text-xs">মোট আয়</p>
                            <p class="font-bold" id="totalEarned">৳0.00</p>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-lg">
                            <p class="text-gray-500 text-xs">মোট উত্তোলন</p>
                            <p class="font-bold" id="totalWithdrawn">৳0.00</p>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <h4 class="font-bold mb-2">সাম্প্রতিক লেনদেন</h4>
                        <div class="bg-gray-100 rounded-lg p-3" id="transactionHistory">
                            <p class="text-gray-500 text-center py-4">কোন লেনদেন নেই</p>
                        </div>
                    </div>
                    
                    <button class="w-full bg-red-500 text-white py-3 rounded-lg text-sm" id="logoutBtn">
                        লগআউট
                    </button>
                </div>
            </div>
        </div>

        <!-- Withdrawal Modal -->
        <div id="withdrawalModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-white rounded-lg p-4 w-full max-w-sm mx-4">
                <h3 class="font-bold mb-4">উত্তোলন রিকোয়েস্ট</h3>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm mb-2">উত্তোলনের পরিমাণ (৳)</label>
                    <input type="number" id="withdrawAmount" class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="200" min="200">
                    <p class="text-xs text-gray-500 mt-1">ন্যূনতম উত্তোলন: ৳200</p>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm mb-2">পদ্ধতি</label>
                    <select id="withdrawMethod" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                        <option value="bkash">বিকাশ</option>
                        <option value="nagad">নগদ</option>
                        <option value="rocket">রকেট</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm mb-2">একাউন্ট নম্বর</label>
                    <input type="text" id="accountNumber" class="w-full border border-gray-300 rounded-lg px-3 py-2" placeholder="01XXXXXXXXX">
                </div>
                
                <div class="flex space-x-3">
                    <button class="flex-1 bg-gray-300 text-gray-800 py-2 rounded-lg" id="cancelWithdrawBtn">
                        বাতিল
                    </button>
                    <button class="flex-1 bg-blue-500 text-white py-2 rounded-lg" id="submitWithdrawBtn">
                        সাবমিট
                    </button>
                </div>
            </div>
        </div>

        <!-- Ad Watch Modal -->
        <div id="adModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
            <div class="bg-white rounded-lg p-4 w-full max-w-sm mx-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold">এড দেখুন</h3>
                    <span class="text-sm" id="adTimer">30s</span>
                </div>
                
                <div class="bg-gray-200 rounded-lg h-40 mb-3 flex items-center justify-center" id="adContainer">
                    <!-- Ad will be loaded here -->
                    <p class="text-gray-500">এড লোড হচ্ছে...</p>
                </div>
                
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div class="bg-blue-600 h-2.5 rounded-full" id="adProgress" style="width: 0%"></div>
                </div>
                
                <button class="w-full bg-red-500 text-white py-2 rounded-lg mt-4 hidden" id="closeAdBtn">
                    বন্ধ করুন
                </button>
            </div>
        </div>
    </div>

    <script>
        // Telegram WebApp initialization
        const tg = window.Telegram.WebApp;
        
        // Bot configuration
        const BOT_TOKEN = '7641873839:AAHt4JsRYUMQDHrrEHdOB-No3ZrtJQeDxXc';
        const ADMIN_ID = '5989402185';
        
        // User data
        let user = {
            id: '',
            name: '',
            username: '',
            balance: 0,
            referralCode: '',
            referralCount: 0,
            adsWatchedToday: 0,
            earnedToday: 0,
            phone: ''
        };
        
        // DOM elements
        const tabButtons = document.querySelectorAll('[data-tab]');
        const tabPanels = document.querySelectorAll('.tab-panel');
        const userBalance = document.getElementById('userBalance');
        const todayEarning = document.getElementById('todayEarning');
        const referralCount = document.getElementById('referralCount');
        const adsWatched = document.getElementById('adsWatched');
        const adsProgress = document.getElementById('adsProgress');
        const referralLink = document.getElementById('referralLink');
        const transactionHistory = document.getElementById('transactionHistory');
        const profileBtn = document.getElementById('profileBtn');
        const profileMenu = document.getElementById('profileMenu');
        
        // Modal elements
        const withdrawalModal = document.getElementById('withdrawalModal');
        const adModal = document.getElementById('adModal');
        
        // Initialize the app
        function initApp() {
            // Expand the WebApp to full view
            tg.expand();
            
            // Get user data from Telegram
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const tgUser = tg.initDataUnsafe.user;
                user.id = tgUser.id;
                user.name = `${tgUser.first_name || ''} ${tgUser.last_name || ''}`.trim();
                user.username = tgUser.username || '';
                
                // Set user initial
                const initials = user.name.split(' ').map(n => n[0]).join('').toUpperCase();
                document.querySelectorAll('#userInitial, #accountInitial').forEach(el => {
                    el.textContent = initials || 'U';
                });
                
                // Set user name
                document.getElementById('userName').textContent = user.name || 'ইউজার';
                document.getElementById('userId').textContent = `ID: ${user.id}`;
                
                // Generate referral code
                user.referralCode = generateReferralCode();
                referralLink.value = `https://t.me/EarningMasterbd24_bot?start=${user.referralCode}`;
                
                // Load user data from backend (simulated here)
                loadUserData();
            } else {
                // Handle case when user data is not available
                console.error('Telegram user data not available');
            }
            
            // Setup event listeners
            setupEventListeners();
        }
        
        // Load user data (simulated)
        function loadUserData() {
            // In a real app, this would come from your backend
            user.balance = 150.50;
            user.referralCount = 5;
            user.adsWatchedToday = 23;
            user.earnedToday = 17.50;
            user.phone = tg.initDataUnsafe.user?.phone_number || '';
            
            // Update UI
            updateUI();
        }
        
        // Update UI with current user data
        function updateUI() {
            userBalance.textContent = `৳${user.balance.toFixed(2)}`;
            todayEarning.textContent = `৳${user.earnedToday.toFixed(2)}`;
            referralCount.textContent = user.referralCount;
            adsWatched.textContent = user.adsWatchedToday;
            adsProgress.style.width = `${user.adsWatchedToday}%`;
            
            // Update transaction history (simulated)
            updateTransactionHistory();
        }
        
        // Generate a referral code
        function generateReferralCode() {
            return `ref_${user.id}_${Math.random().toString(36).substr(2, 5)}`;
        }
        
        // Update transaction history (simulated)
        function updateTransactionHistory() {
            // Sample transactions
            const transactions = [
                { type: 'ad', amount: 0.75, date: 'আজ ১০:৩০ AM', status: 'completed' },
                { type: 'ad', amount: 0.50, date: 'আজ ০৯:১৫ AM', status: 'completed' },
                { type: 'referral', amount: 10.00, date: 'গতকাল', status: 'completed' },
                { type: 'withdrawal', amount: 200.00, date: '২ দিন আগে', status: 'pending' }
            ];
            
            if (transactions.length === 0) {
                return;
            }
            
            let html = '';
            transactions.forEach(txn => {
                const isPositive = txn.type !== 'withdrawal';
                const icon = txn.type === 'ad' ? '📺' : txn.type === 'referral' ? '👥' : '💸';
                const typeText = txn.type === 'ad' ? 'এড দেখেছেন' : txn.type === 'referral' ? 'রেফার বোনাস' : 'উত্তোলন';
                
                html += `
                <div class="flex justify-between items-center py-3 border-b border-gray-200">
                    <div class="flex items-center">
                        <span class="mr-2">${icon}</span>
                        <div>
                            <p class="text-sm">${typeText}</p>
                            <p class="text-xs text-gray-500">${txn.date}</p>
                        </div>
                    </div>
                    <span class="${isPositive ? 'text-green-500' : 'text-red-500'} font-bold">
                        ${isPositive ? '+' : '-'}৳${txn.amount.toFixed(2)}
                    </span>
                </div>
                `;
            });
            
            transactionHistory.innerHTML = html;
        }
        
        // Send withdrawal request to admin via bot
        async function sendWithdrawalRequest(amount, method, account) {
            const message = `
            নতুন উত্তোলন রিকোয়েস্ট:
            ইউজার: ${user.name} (@${user.username})
            ইউজার আইডি: ${user.id}
            ফোন: ${user.phone}
            পরিমাণ: ৳${amount}
            পদ্ধতি: ${method}
            একাউন্ট: ${account}
            
            কনফার্ম করতে /done_${user.id} কমান্ড পাঠান
            `;
            
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: ADMIN_ID,
                        text: message,
                        parse_mode: 'HTML'
                    })
                });
                
                const data = await response.json();
                return data.ok;
            } catch (error) {
                console.error('Error sending withdrawal request:', error);
                return false;
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Profile menu toggle
            profileBtn.addEventListener('click', () => {
                profileMenu.classList.toggle('active');
            });
            
            // Close profile menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
                    profileMenu.classList.remove('active');
                }
            });
            
            // Profile menu navigation
            profileMenu.querySelectorAll('a[data-tab]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabName = link.getAttribute('data-tab');
                    
                    // Update active tab button
                    tabButtons.forEach(btn => btn.classList.remove('tab-active'));
                    document.querySelector(`[data-tab="${tabName}"]`).classList.add('tab-active');
                    
                    // Show corresponding tab panel
                    tabPanels.forEach(panel => panel.classList.add('hidden'));
                    document.getElementById(`${tabName}Tab`).classList.remove('hidden');
                    
                    // Close menu
                    profileMenu.classList.remove('active');
                });
            });
            
            // Tab switching (for bottom tabs - kept for compatibility)
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabName = button.getAttribute('data-tab');
                    
                    // Update active tab button
                    tabButtons.forEach(btn => btn.classList.remove('tab-active'));
                    button.classList.add('tab-active');
                    
                    // Show corresponding tab panel
                    tabPanels.forEach(panel => panel.classList.add('hidden'));
                    document.getElementById(`${tabName}Tab`).classList.remove('hidden');
                });
            });
            
            // Withdrawal button
            document.getElementById('withdrawBtn').addEventListener('click', () => {
                withdrawalModal.classList.remove('hidden');
            });
            
            // Cancel withdrawal
            document.getElementById('cancelWithdrawBtn').addEventListener('click', () => {
                withdrawalModal.classList.add('hidden');
            });
            
            // Submit withdrawal
            document.getElementById('submitWithdrawBtn').addEventListener('click', async () => {
                const amount = parseFloat(document.getElementById('withdrawAmount').value);
                const method = document.getElementById('withdrawMethod').value;
                const account = document.getElementById('accountNumber').value;
                
                if (amount < 200) {
                    alert('ন্যূনতম উত্তোলন ৳200');
                    return;
                }
                
                if (amount > user.balance) {
                    alert('আপনার ব্যালেন্স পর্যাপ্ত নয়');
                    return;
                }
                
                if (!account) {
                    alert('অ্যাকাউন্ট নম্বর দিন');
                    return;
                }
                
                // Send withdrawal request to admin
                const success = await sendWithdrawalRequest(amount, method, account);
                
                if (success) {
                    // Deduct from balance
                    user.balance -= amount;
                    updateUI();
                    withdrawalModal.classList.add('hidden');
                    alert('আপনার উত্তোলন রিকোয়েস্ট সাবমিট হয়েছে। ২৪ ঘন্টার মধ্যে প্রসেস করা হবে।');
                } else {
                    alert('রিকোয়েস্ট পাঠাতে সমস্যা হয়েছে। পরে আবার চেষ্টা করুন।');
                }
            });
            
            // Watch ad button
            document.getElementById('watchAdBtn').addEventListener('click', () => {
                if (user.adsWatchedToday >= 100) {
                    alert('আপনি আজ ১০০টি এড দেখেছেন। আগামীকাল আবার চেষ্টা করুন।');
                    return;
                }
                
                startAdWatch();
            });
            
            // Quick earn button
            document.getElementById('quickEarnBtn').addEventListener('click', () => {
                document.querySelector('[data-tab="earn"]').click();
            });
            
            // Quick refer button
            document.getElementById('quickReferBtn').addEventListener('click', () => {
                document.querySelector('[data-tab="refer"]').click();
            });
            
            // Copy referral link
            document.getElementById('copyLinkBtn').addEventListener('click', () => {
                referralLink.select();
                document.execCommand('copy');
                alert('রেফার লিংক কপি হয়েছে!');
            });
            
            // Share referral link
            document.getElementById('shareLinkBtn').addEventListener('click', () => {
                if (tg.isVersionAtLeast('6.1')) {
                    tg.shareUrl({
                        url: referralLink.value,
                        title: 'টাকা আয় করুন টেলিগ্রামে',
                        text: 'আমার রেফার লিংক ব্যবহার করে টাকা আয় করুন!'
                    });
                } else {
                    alert('আপনার টেলিগ্রাম অ্যাপ আপডেট করুন লিংক শেয়ার করার জন্য।');
                }
            });
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', () => {
                tg.close();
            });
            
            // Logout from profile menu
            document.getElementById('logoutMenuBtn').addEventListener('click', (e) => {
                e.preventDefault();
                tg.close();
            });
        }
        
        // Simulate watching an ad
        function startAdWatch() {
            const adModal = document.getElementById('adModal');
            const adTimer = document.getElementById('adTimer');
            const adProgress = document.getElementById('adProgress');
            const closeAdBtn = document.getElementById('closeAdBtn');
            
            adModal.classList.remove('hidden');
            closeAdBtn.classList.add('hidden');
            
            // Show Monitag ad
            document.getElementById('adContainer').innerHTML = `
                <div id="monitag-ad-container" class="w-full h-full"></div>
            `;
            
            // Initialize Monitag ad
            if (typeof show_9571958 !== 'undefined') {
                show_9571958();
            }
            
            let secondsLeft = 30;
            let progress = 0;
            const interval = setInterval(() => {
                secondsLeft--;
                progress = ((30 - secondsLeft) / 30) * 100;
                
                adTimer.textContent = `${secondsLeft}s`;
                adProgress.style.width = `${progress}%`;
                
                if (secondsLeft <= 0) {
                    clearInterval(interval);
                    adTimer.textContent = 'সমাপ্ত!';
                    closeAdBtn.classList.remove('hidden');
                    
                    // Reward user
                    const reward = (Math.random() * 0.5 + 0.5).toFixed(2);
                    user.balance += parseFloat(reward);
                    user.earnedToday += parseFloat(reward);
                    user.adsWatchedToday++;
                    
                    updateUI();
                }
            }, 1000);
            
            // Close ad button
            closeAdBtn.addEventListener('click', () => {
                clearInterval(interval);
                adModal.classList.add('hidden');
            }, { once: true });
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
